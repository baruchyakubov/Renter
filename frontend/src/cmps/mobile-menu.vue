<template>
  <div class="mobile-menu">
    <div @click="goToExplore()" :class="{activePage: isActive === 'Explore'}">
      <svg viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="presentation"
        focusable="false"
        style="display: block; fill: none; height: 24px; width: 24px; stroke: #717171; stroke-width: 4; overflow: visible;">
        <g fill="none">
          <path
            d="m13 24c6.0751322 0 11-4.9248678 11-11 0-6.07513225-4.9248678-11-11-11-6.07513225 0-11 4.92486775-11 11 0 6.0751322 4.92486775 11 11 11zm8-3 9 9">
          </path>
        </g>
      </svg>
      <p>Explore</p>
    </div>
    <div @click="goToWishList()" :class="{ activePage: isActive === 'wishlist' }">
      <svg viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="presentation"
        focusable="false"
        style="display: block; fill: none; height: 24px; width: 24px; stroke: #717171; stroke-width: 2.66667; overflow: visible;">
        <path
          d="m16 28c7-4.733 14-10 14-17 0-1.792-.683-3.583-2.05-4.95-1.367-1.366-3.158-2.05-4.95-2.05-1.791 0-3.583.684-4.949 2.05l-2.051 2.051-2.05-2.051c-1.367-1.366-3.158-2.05-4.95-2.05-1.791 0-3.583.684-4.949 2.05-1.367 1.367-2.051 3.158-2.051 4.95 0 7 7 12.267 14 17z">
        </path>
      </svg>
      <p>Wishlist</p>
    </div>
    <div v-if="!currUser" @click="goToLogin()">
      <svg viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="presentation"
        focusable="false" style="display: block; height: 24px; width: 24px;  fill: #717171;">
        <path
          d="m16 1c8.2842712 0 15 6.71572875 15 15 0 8.2842712-6.7157288 15-15 15-8.28427125 0-15-6.7157288-15-15 0-8.28427125 6.71572875-15 15-15zm0 8c-2.7614237 0-5 2.2385763-5 5 0 2.0143973 1.2022141 3.7998876 2.9996346 4.5835001l.0003231 2.0984999-.1499943.0278452c-2.8326474.5613112-5.31897338 2.2230336-6.93575953 4.5872979 2.34343054 2.291067 5.54974273 3.7028569 9.08579613 3.7028569 3.5355506 0 6.7414538-1.4113884 9.0850203-3.701476-1.6141801-2.3628535-4.0978119-4.0247647-6.929184-4.5867938l-.1558786-.0287302.001228-2.0991413c1.7288399-.7547474 2.9066959-2.4357565 2.9936498-4.355479l.0051645-.2283797c0-2.7614237-2.2385763-5-5-5zm0-6c-7.17970175 0-13 5.82029825-13 13 0 2.9045768.95257276 5.5866683 2.56235849 7.7509147 1.42074739-1.9134907 3.33951478-3.4002416 5.53860831-4.2955956l.3480332-.1363191-.0229565-.0189706c-1.43704227-1.2411241-2.34462949-3.045583-2.42083359-5.0285539l-.00520991-.2714755c0-3.8659932 3.1340068-7 7-7s7 3.1340068 7 7c0 1.9941317-.8415062 3.8279876-2.224566 5.1193683l-.225434.2006317.0447787.0163138c2.3268368.8792152 4.3570558 2.4138611 5.8430586 4.4127726 1.6098837-2.1632453 2.5621627-4.8449575 2.5621627-7.7490864 0-7.17970175-5.8202983-13-13-13z">
        </path>
      </svg>
      <p>Login</p>
    </div>
    <div v-if="currUser?.isAdmin" @click="goToBackOffice()" :class="{ activePage: isActive === 'backOffice' }">
      <svg xmlns="http://www.w3.org/2000/svg"
        style="height:24px; width: 24px; stroke-width: 7; stroke: #717171; fill: #717171;"
        xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" id="Capa_1" viewBox="0 0 320.281 320.281"
        xml:space="preserve">
        <g>
          <path
            d="M260.727,115.941l-97.891,53.473V57.89c0-4.971-4.029-9-9-9c-74.823,0-135.695,60.873-135.695,135.695   s60.873,135.696,135.695,135.696s135.696-60.873,135.696-135.696c0-22.735-5.739-45.234-16.596-65.067   C270.551,115.161,265.087,113.561,260.727,115.941z M153.836,302.281c-64.897,0-117.695-52.798-117.695-117.696   c0-61.871,47.984-112.745,108.695-117.354v117.354c0,3.177,1.675,6.119,4.408,7.741c2.733,1.622,6.119,1.682,8.906,0.158   l103.007-56.267c6.807,15.117,10.375,31.667,10.375,48.369C271.531,249.482,218.733,302.281,153.836,302.281z" />
          <path
            d="M301.035,70.59c-23.221-42.42-67.63-69.468-115.896-70.588c-4.974-0.1-9.089,3.817-9.207,8.785l-2.995,126.658   c-0.076,3.215,1.569,6.226,4.314,7.898c1.436,0.875,3.058,1.314,4.684,1.314c1.482,0,2.968-0.366,4.314-1.102L297.455,82.81   c2.096-1.145,3.651-3.076,4.322-5.368C302.449,75.15,302.182,72.685,301.035,70.59z M191.3,120.286l2.406-101.733   c35.355,3.565,67.468,23.126,86.91,52.944L191.3,120.286z" />
        </g>
      </svg>
      <p>Back-office</p>
    </div>
    <div v-if="currUser" @click="goToOrders()" :class="{ activePage: isActive === 'userOrders' }">
      <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" id="Layer_1"
        x="0px" y="0px" viewBox="0 0 115.35 122.88"
        style="enable-background:new 0 0 115.35 122.88;height: 24px;width: 24px;fill: #717171;stroke: #717171; stroke-width: 2.66667;"
        xml:space="preserve">
        <g>
          <path
            d="M25.27,86.92c-1.81,0-3.26-1.46-3.26-3.26s1.47-3.26,3.26-3.26h21.49c1.81,0,3.26,1.46,3.26,3.26s-1.46,3.26-3.26,3.26 H25.27L25.27,86.92L25.27,86.92z M61.1,77.47c-0.96,0-1.78-0.82-1.78-1.82c0-0.96,0.82-1.78,1.78-1.78h4.65c0.04,0,0.14,0,0.18,0 c1.64,0.04,3.1,0.36,4.33,1.14c1.37,0.87,2.37,2.19,2.92,4.15c0,0.04,0,0.09,0.05,0.14l0.46,1.82h39.89c1,0,1.78,0.82,1.78,1.78 c0,0.18-0.05,0.36-0.09,0.55l-4.65,18.74c-0.18,0.82-0.91,1.37-1.73,1.37l0,0l-29.18,0c0.64,2.37,1.28,3.65,2.14,4.24 c1.05,0.68,2.87,0.73,5.93,0.68h0.04l0,0h20.61c1,0,1.78,0.82,1.78,1.78c0,1-0.82,1.78-1.78,1.78H87.81l0,0 c-3.79,0.04-6.11-0.05-7.98-1.28c-1.92-1.28-2.92-3.46-3.92-7.43l0,0L69.8,80.2c0-0.05,0-0.05-0.04-0.09 c-0.27-1-0.73-1.69-1.37-2.05c-0.64-0.41-1.5-0.59-2.51-0.59c-0.05,0-0.09,0-0.14,0H61.1L61.1,77.47L61.1,77.47z M103.09,114.13 c2.42,0,4.38,1.96,4.38,4.38s-1.96,4.38-4.38,4.38s-4.38-1.96-4.38-4.38S100.67,114.13,103.09,114.13L103.09,114.13L103.09,114.13z M83.89,114.13c2.42,0,4.38,1.96,4.38,4.38s-1.96,4.38-4.38,4.38c-2.42,0-4.38-1.96-4.38-4.38S81.48,114.13,83.89,114.13 L83.89,114.13L83.89,114.13z M25.27,33.58c-1.81,0-3.26-1.47-3.26-3.26c0-1.8,1.47-3.26,3.26-3.26h50.52 c1.81,0,3.26,1.46,3.26,3.26c0,1.8-1.46,3.26-3.26,3.26H25.27L25.27,33.58L25.27,33.58z M7.57,0h85.63c2.09,0,3.99,0.85,5.35,2.21 s2.21,3.26,2.21,5.35v59.98h-6.5V7.59c0-0.29-0.12-0.56-0.31-0.76c-0.2-0.19-0.47-0.31-0.76-0.31l0,0H7.57 c-0.29,0-0.56,0.12-0.76,0.31S6.51,7.3,6.51,7.59v98.67c0,0.29,0.12,0.56,0.31,0.76s0.46,0.31,0.76,0.31h55.05 c0.61,2.39,1.3,4.48,2.23,6.47H7.57c-2.09,0-3.99-0.85-5.35-2.21C0.85,110.24,0,108.34,0,106.25V7.57c0-2.09,0.85-4,2.21-5.36 S5.48,0,7.57,0L7.57,0L7.57,0z M25.27,60.25c-1.81,0-3.26-1.46-3.26-3.26s1.47-3.26,3.26-3.26h50.52c1.81,0,3.26,1.46,3.26,3.26 s-1.46,3.26-3.26,3.26H25.27L25.27,60.25L25.27,60.25z" />
        </g>
      </svg>
      <p>Orders</p>
    </div>
    <div v-if="currUser" @click="logout()">
      <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" fill="#000000" height="800px"
        width="800px" version="1.1" id="Capa_1" viewBox="0 0 384.971 384.971" xml:space="preserve"
        style="&#10;    height: 24px;&#10;    width: 24px;&#10;    stroke-width: 2.66667;&#10;    stroke: #717171;&#10;    fill: #717171;&#10;">
        <g>
          <g id="Sign_Out">
            <path
              d="M180.455,360.91H24.061V24.061h156.394c6.641,0,12.03-5.39,12.03-12.03s-5.39-12.03-12.03-12.03H12.03    C5.39,0.001,0,5.39,0,12.031V372.94c0,6.641,5.39,12.03,12.03,12.03h168.424c6.641,0,12.03-5.39,12.03-12.03    C192.485,366.299,187.095,360.91,180.455,360.91z" />
            <path
              d="M381.481,184.088l-83.009-84.2c-4.704-4.752-12.319-4.74-17.011,0c-4.704,4.74-4.704,12.439,0,17.179l62.558,63.46H96.279    c-6.641,0-12.03,5.438-12.03,12.151c0,6.713,5.39,12.151,12.03,12.151h247.74l-62.558,63.46c-4.704,4.752-4.704,12.439,0,17.179    c4.704,4.752,12.319,4.752,17.011,0l82.997-84.2C386.113,196.588,386.161,188.756,381.481,184.088z" />
          </g>
          <g>
          </g>
          <g>
          </g>
          <g>
          </g>
          <g>
          </g>
          <g>
          </g>
          <g>
          </g>
        </g>
      </svg>
      <p>Logout</p>
    </div>
  </div>
</template>

<script>
import { authService } from '../services/auth.service'
import { eventBus, showErrorMsg ,showSuccessMsg } from '../services/event-bus.service'

export default {
  data() {
    return {
      isActive: ''
    }
  },
  created() {
    this.checkRoute()
  },
  methods: {
    goToExplore() {
      this.$router.push('/')
    },
    goToWishList() {
      const user = authService.getLoggedinUser()
      if (!user) {
        showErrorMsg('Login required')
        return
      }
      this.$router.push('/wishlist')
    },
    goToLogin() {
      eventBus.emit('openModal', 'log')
    },
    goToBackOffice() {
      this.$router.push('/backOffice')
    },
    goToOrders() {
      this.$router.push('/userOrders')
    },
    async logout() {
      try {
        await this.$store.dispatch({ type: 'logout' })
        this.$router.push('/')
        showSuccessMsg('Logged out succesfully')
      } catch {
        showErrorMsg('Failed to logout')
      }
    },
    checkRoute() {
      if (this.$route.path === '/') {
        this.isActive = 'Explore'
      } else
        this.isActive = this.$route.path.substring(1)
    }
  },

  computed: {
    currUser() {
      return this.$store.getters.loggedinUser
    }
  },
  watch: {
    '$route': function () {
      this.checkRoute()
    }
  }
}
</script>